{
  "hash": "cbdbfa073e285d39279f2c410f6f63e5",
  "result": {
    "markdown": "---\ntitle: \"Diffusion driven instability\"\nformat: html\n---\n\n## Spatial Pattern Formation via Reaction-Diffusion\n\n*Insert human embryogenesis image*\n\n### Pattern in Developmental Biology\n\n\n\n\n\nEmbryology or developmental biology is that part of biology which is concerned with the formation, growth and development of the embryo from fertilization until birth. From the very moment of conception the embryo undergoes a process of dynamic change, brought about largely by cells responding to various chemical signalling cues e.g. migration, differentiation, proliferation. Figure ref{embryogenesis} shows some of the major changes in embryonic development which occur up to a few weeks after fertilization. Many of the processes occurring at this early stage are vital for the successful subsequent development of the embryo and also lay down basic structures (e.g. [ somites](https://en.wikipedia.org/wiki/Somite)) that form the foundation of major body structures later on (e.g. the vertebrae of the spine)  cf. Professor Lewis Wolpert: '*It is not birth, marriage, or death, but gastrulation which is truly the most important time in your life.*'\n\n\n\nThere are two main theories which describe how pattern arises during embryogenesis - one is the  *Turing pre-pattern theory*, the other is the *mechano-chemical* theory. In the Turing pre-pattern theory, chemicals, or [morphogens](https://en.wikipedia.org/wiki/Morphogen), react together and, if certain conditions concerning their reaction kinetics and diffusion rates are satisfied (to be derived in the next section), then a *pre-pattern* of varying chemical concentrations is set up in the spatial domain. This means that throughout the spatial domain, the concentration levels of the chemicals will vary i.e. there will be a *heterogeneous* distribution of chemical concentrations which is known as a pre-pattern. Any cells in the domain which subsequently encounter these varying levels of morphogens will then respond by, for example, proliferating differentially throughout the domain. In this way, the domain will then contain a {spatially heterogeneous} distribution of cell densities (i.e. a cellular pattern) which have responded to the morphogen pre-pattern. This pre-pattern theory was first proposed by Alan Turing (of Enigma Code fame) in his seminal 1952 paper, *The chemical basis of morphogenesis* @turing1990chemical. This was developed in more detailed manner by Alfred Gierer and Hans Meinhardt in another ground-breaking paper in 1972, *A theory of biological pattern formation* @gierer1972theory, where they introduced the concept of activating chemicals and inhibiting chemicals. J.D. Murray then applied the theory as an explanation for the generation of patterns observed on animal coats @murray1981pre. \n\nIn the mechano-chemical theory, cells interact with their surroundings and by exerting forces perturb their local environment. The combination of cell migration/proliferation and cell-generated forces is sufficient in certain circumstances to create a spatially heterogeneous distribution of cell densities i.e. the pattern is generated *simultaneously* with the cell migration/proliferation.  This alternative pattern formation theory was proposed by Murray and Oster @murray1984generation and is particularly appropriate for patterns generated in early embryogenesis by *mesenchymal cells* such as fibroblasts. \n\n## Reaction-diffusion (Turing) Pre-pattern Mechanisms\n\nWe now consider our general (dimensional) reaction-diffusion model for two chemicals or morphogens with concentrations $A({\\mathbf{x}}, t)$ and $B({\\mathbf{x}}, t)$ which react together and diffuse in some spatial domain:\n\n$$\n\\begin{aligned}\n\\frac{\\partial A}{\\partial  t} & =  F(A,B)  + D_A \\nabla^2 A, \\\\\n\\frac{\\partial B}{\\partial  t} & =  G(A,B)  + D_B \\nabla^2 B,\n\\end{aligned}\n$$\n\nwhere $F(A,B)$ and $G(A,B)$ describe the reaction kinetics between the two morphogens and $D_A, D_B > 0$ are the diffusion coefficients. Turing's theory (Turing, 1952) *The chemical basis of morphogenesis* proposed that it was the diffusion of the substances $A,B$ which led to the evolution of a spatially heterogeneous solution to arise i.e. a spatial pattern. This has given rise to the phrase *diffusion-driven instability*. This was a rather revolutionary and counter-intuitive proposal, since, as we have seen, diffusion normally has the opposite tendency i.e. to smooth or average out spatial heterogeneities, and to give rise to spatially homogeneous solutions.  \n\nVarious forms can be considered for the kinetic functions $F$ and $G$. However, we will focus mainly on three specific classes as follows:\n\n### Schnackenberg kinetics\n\n$$\nF(A,B) = k_1 - k_2 A + k_3 A^2 B, \\;\\;\\;\\; G(A,B) = k_4 - k_3 A^2 B\n$$\n\n$k_1, k_2, k_3, k_4 >0$. The term $k_3 A^2 B$ is *autocatalytic*, since the species $A$ upregulates its own production. \n\n###  Gierer and Meinhardt kinetics\n\nGierer and Meinhardt developed a model that describes activator-inhibitor kinetics. The  total reaction rates are\n$$\nF(A,B) = k_1 - k_2 A + \\frac{k_3 A^2}{B}, \\quad G(A,B) = k_4 A^2 - k_5 B\n$$\nwhere\n$k_1, k_2, k_3, k_4 , k_5 > 0$. The term $k_3 A^2 / B$ is **autocatalytic**. \n\n### Thomas kinetics\n\nThomas developed a model of substrate inhibition in which\n$$\n\\begin{aligned}\nF(A,B) &= k_1 - k_2 A - H(A,B), \\\\\nG(A,B) &= k_4 A^2 - k_4 B -H(A,B), \\\\ \nH(A,B) &= \\frac{k_5 AB}{k_6 + k_7 + k_8 A^2}.\n\\end{aligned}\n$$\nwith $k_i > 0$. In the original paper of Thomas (1975), $A$ represents the concentration of oxygen (substrate) and $B$ the concentration of uricase (enzyme). Substrate inhibition is evident in the term $k_8 A^2$. \n\n## Non-dimensionalization\n\nBefore proceeding with our analysis, it is prudent to non-dimensionalize each of the above systems. \n\n### Schnakenberg\n\nWe illustrate this process for the Schnakenberg kinetics. Using the scaling\n\n$$\nu = A \\left( \\frac{k_3}{k_2} \\right)^{1/2}, \\quad v = B \\left( \\frac{k_3}{k_2} \\right)^{1/2}, \\quad t^* = \\frac{D_A t}{L^2},\\quad x^* = \\frac{x}{L},\n$$\n\nwhere $L$ is a typical length scale, the dimensionless reaction-diffusion system with Schnakenberg kinetics becomes (upon dropping the $*$ for notational convenience):\n\n$$\n\\begin{aligned}\n\\frac{\\partial u}{\\partial  t} & = \\gamma ( a - u + u^2 v ) + \\nabla^2 u = \\gamma f(u,v)  + \\nabla^2 u, \\\\\n\\frac{\\partial v}{\\partial  t} & = \\gamma ( b - u^2 v ) + d \\nabla^2 v = \\gamma g(u,w)  + d \\nabla^2 v, \n\\end{aligned}\n$$ {#eq-schnackenbergeqns}\n\nwhere \n$$\nd = \\frac{D_B}{D_A}, \\quad a = \\frac{k_1}{k_2} \\left( \\frac{k_3}{k_2} \\right)^{1/2}, \\quad b = \\frac{k_4}{k_2} \\left( \\frac{k_3}{k_2} \\right)^{1/2}, \\quad \\gamma = \\frac{L^2 k_2}{D_A}.\n$$\n\n### Gierer and Meinhardt\n\nThe Gierer-Meinhardt kinetics can be non-dimensionalized as follows:\n\n$$\n\\begin{aligned}\nf(u, v) & =  a - b u + \\frac{u^2}{v}, \ng(u,v) &= u^2 - v, \\\\\n\\end{aligned}\n$$\nwhere $a$ and $b$ are positive parameters (Exercise/Tutorial).\n\n### Thomas\n\nThe Thomas kinetics can be non-dimensionalized as follows:\n \n$$\n\\begin{aligned}\nf(u,v) & =  a - u - h(u,v), \\\\\ng(u,v) &= \\alpha (b - v) - h(u,v), \\\\\nh(u,v) & =  \\frac{\\rho u v}{1 + u + K u^2},\n\\end{aligned}\n$$\nwhere $a , b, \\alpha, \\rho , K$ are positive parameters (see Exercise/Tutorial).\n\n\n### General\n\nAny reaction-diffusion system can be non-dimensionalized and scaled following the above procedure to take the following general form:\n\n$$\n\\begin{aligned}\n\\frac{\\partial u}{\\partial  t} & = \\gamma f(u,v)  + \\nabla^2 u, \\\\\n\\frac{\\partial v}{\\partial  t} & = \\gamma g(u,w)  + d \\nabla^2 v, \n\\end{aligned}\n$$\n\nwhere the parameter $d$ is the ratio of the diffusion coefficients from the dimensional system and the parameter $\\gamma$ can be interpreted in any one of the following ways:\n\n* $\\gamma^{1/2}$ is proportional to the  **linear size** of the spatial domain in one-dimension. In two-dimensions, $\\gamma$ is proportional to the area. \n* $\\gamma$ represents the relative strength of the reaction terms -- an increase in $\\gamma$ may represent an increase in the activity of some rate-limiting step in the reaction sequence. \n* An increase in $\\gamma$ is equivalent to a decrease in the diffusion coefficient, $d$. \n\nNote that in the case where the parameter $d > 1$, this means that the original diffusion coefficients are not equal. Specifically, in the case of the Gierer-Meinhardt activator-inhibitor system, $d >1$ implies that the inhibitor *diffuses more quickly* than the activator [$d > 1 \\Rightarrow D_B > D_A$ ]. The spatial implications of this are shown in @fig_ai -- the inhibitor diffuses a greater distance than the activator, giving rise to what is known as *local activation, long-range inhibition*. \n\n\n** Insert activator_inhibitor here **\n\n## Numerical solution\n\nIn @fig-schnack_ddi_pde we plot numerical solutions of @eq-schnackenbergeqns with no flux boundary conditions. \n\nIn this numerical solution the initial condition are the spatially homogeneous steady state perturbed by uniformly sampled noise. As time evolves, a spatial pattern emerges. The main idea from a biological perspeftive is that an unpatterned region of an embryo could undergo chemical reactions, with the result being a patterned chemcial field. \n\nSome question that might arise:\n\n* How does pattern formation depend on model parameters?\n* How does pattern formation depend on domain size?\n* How does the pattern wavelength depend on model parameters?\n* How does the pattern depend on the initial conditions?\n* How can we numerically solve the reaction diffusion PDEs?\n\n::: {.cell execution_count=1}\n``` {.python .cell-code code-fold=\"true\"}\nimport numpy as np\nfrom scipy.integrate import odeint\nfrom scipy.integrate import solve_ivp\n\nimport matplotlib.pyplot as plt\nimport random\n\nT=3\nL=1\n\ngamma=650.0\na=0.2\nb=1.3\nd=30.0\n\nN_x=80\nN_t=50\n\nt=np.linspace(1,T,N_t)\nx=np.linspace(0,L,N_x)\n\nu_0=(a+b)*np.ones_like(x)+0.01*np.random.uniform(low=-1.0, high=1.0, size=(N_x,))\nv_0=b*(1/(a+b)**2)*np.ones_like(x)+0.01*np.random.uniform(low=-1.0, high=1.0, size=(N_x,))\n\nu_0=np.concatenate((u_0,v_0))\n\ndx=L/(N_x-1)\ndt=T/(N_t-1)\n\ndef ShcnackPDErhs(sol,t):\n\n    N_x=int(np.ceil(len(sol)/2))\n\n    u=sol[0:N_x]\n    v=sol[N_x:]\n\n    f_u=np.zeros_like(u)\n    f_v=np.zeros_like(u)\n\n    for i in range(1,N_x-2):\n      f_u[i]=1/dx**2*(u[i-1]-2*u[i]+u[i+1]) \n\n    i=0\n    f_u[i]=1/dx**2*(-u[i]+u[i+1])\n\n    i=N_x-1\n    f_u[i]=1/dx**2*(u[i-1]-u[i])\n\n\n    for i in range(1,N_x-2):\n      f_v[i]=d/dx**2*(v[i-1]-2*v[i]+v[i+1]) \n    i=0\n    f_v[i]=d/dx**2*(-v[i]+v[i+1]) \n    i=N_x-1\n    f_v[i]=d/dx**2*(v[i-1]-v[i])\n\n    reaction_u=gamma*(a-u+(u**2)*v)\n    reaction_v=gamma*(b-(u**2)*v)\n\n    f_u=f_u+reaction_u\n    f_v=f_v+reaction_v\n\n    f= np.concatenate((f_u,f_v)) \n    return f  \n\nsol=odeint(ShcnackPDErhs,u_0,t)\nu=sol[:,0:N_x]\nv=sol[:,N_x:]\n\nfig, ax = plt.subplots(2,1)\n\nax[0].plot(x,u[0,:],'r')\nax[0].plot(x,u[16,:],'b')\nax[0].plot(x,u[32,:],'m')\nax[0].plot(x,u[48,:],'k')\nax[0].set_xlabel('$x$')\nax[0].set_ylabel('$u$')\n\nax[1].plot(x, v[0,:],'r--')\nax[1].plot(x, v[16,:],'b--')\nax[1].plot(x, v[32,:],'m--')\nax[1].plot(x, v[48,:],'k--')\nax[1].set_xlabel('$x$')\nax[1].set_ylabel('$v$')\n\nplt.legend(['t'+ str(t[0]),'t='+ str(t[4]),'t='+ str(t[8]),'t='+ str(t[12])])\nplt.xlabel('$x$')\nplt.grid()\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![DDI with Schnackenberg kinetics](DiffusionDrivenInstability_files/figure-html/fig-schnack_ddi_pde-output-1.png){#fig-schnack_ddi_pde width=597 height=429}\n:::\n:::\n\n\nIn Figure @fig-schnack_ddi_pde_2d we consider a numerical solution of the Schnackenberg model on a 2D square domain with no-flux boundary conditions. Note \n\n::: {.cell cache='true' execution_count=2}\n``` {.python .cell-code code-fold=\"true\"}\nimport numpy as np\nfrom scipy.integrate import odeint\nfrom scipy.integrate import solve_ivp\n\nimport matplotlib.pyplot as plt\nimport random\n\nT=5\nL=1\n\ngamma=650.0\na=0.2\nb=1.3\nd=25.0\n\nN_x=20\nN_t=30\n\nt=np.linspace(1,T,N_t)\nx=np.linspace(0,L,N_x)\ny=np.linspace(0,L,N_x)\n\n[x,y]=np.meshgrid(x,y)\n\nu_0=(a+b)*np.ones_like(x)+0.01*np.random.uniform(low=-1.0, high=1.0, size=(N_x,N_x))\nv_0=b*(1/(a+b)**2)*np.ones_like(x)+0.01*np.random.uniform(low=-1.0, high=1.0, size=(N_x,N_x))\n\nu_0=np.concatenate((np.ravel(u_0),np.ravel(v_0)))\n\ndx=L/(N_x-1)\ndt=T/(N_t-1)\n\n\n\ndef ShcnackPDErhs2d(sol,t):\n\n    num_nodes=int(np.ceil(len(sol)/2))\n\n    u=sol[0:num_nodes]\n    v=sol[num_nodes:]\n\n\n    u=np.reshape(u,(N_x,N_x))\n    v=np.reshape(v,(N_x,N_x))\n\n    f_u=np.zeros_like(u)\n    f_v=np.zeros_like(u)\n\n \n\n    for i in range(1,N_x-2):\n      for j in range(1,N_x-2):\n        f_u[i,j]=1/dx**2*(u[i-1,j]-4*u[i,j]+u[i+1,j]+u[i,j+1]+u[i,j-1]) \n        f_v[i,j]=d/dx**2*(v[i-1,j]-4*v[i,j]+v[i+1,j]+v[i,j+1]+v[i,j-1]) \n\n    i=0 \n    for j in range(1,N_x-2):\n      f_u[i,j]=1/dx**2*(-3*u[i,j]+u[i+1,j]+u[i,j+1]+u[i,j-1]) \n      f_v[i,j]=d/dx**2*(-3*v[i,j]+v[i+1,j]+v[i,j+1]+v[i,j-1]) \n\n    i=N_x-1\n    for j in range(1,N_x-2):\n      f_u[i,j]=1/dx**2*(u[i-1,j]-3*u[i,j]+u[i,j+1]+u[i,j-1]) \n      f_v[i,j]=d/dx**2*(v[i-1,j]-3*v[i,j]+v[i,j+1]+v[i,j-1])   \n\n    j=0\n    for i in range(1,N_x-2):\n        f_u[i,j]=1/dx**2*(u[i-1,j]-3*u[i,j]+u[i+1,j]+u[i,j+1]) \n        f_v[i,j]=d/dx**2*(v[i-1,j]-3*v[i,j]+v[i+1,j]+v[i,j+1]) \n\n    j =N_x-1\n    for i in range(1,N_x-2):\n        f_u[i,j]=1/dx**2*(u[i-1,j]-3*u[i,j]+u[i+1,j]+u[i,j-1]) \n        f_v[i,j]=d/dx**2*(v[i-1,j]-3*v[i,j]+v[i+1,j]+v[i,j-1])  \n\n    i=0\n    j=0\n    f_u[i,j]=1/dx**2*(-2*u[i,j]+u[i+1,j]+u[i,j+1]) \n    f_v[i,j]=d/dx**2*(-2*v[i,j]+v[i+1,j]+v[i,j+1]) \n\n    i=0\n    j=N_x-1\n    f_u[i,j]=1/dx**2*(-2*u[i,j]+u[i+1,j]+u[i,j-1]) \n    f_v[i,j]=d/dx**2*(-2*v[i,j]+v[i+1,j]+v[i,j-1]) \n\n    i=N_x-1\n    j=0\n\n    f_u[i,j]=1/dx**2*(u[i-1,j]-2*u[i,j]+u[i,j+1]) \n    f_v[i,j]=d/dx**2*(v[i-1,j]-2*v[i,j]+v[i,j+1]) \n    \n    i=N_x-1\n    j=N_x-1\n\n\n    f_u[i,j]=1/dx**2*(-2*u[i,j]+u[i-1,j]+u[i,j-1]) \n    f_v[i,j]=d/dx**2*(-2*v[i,j]+v[i-1,j]+v[i,j-1]) \n\n\n    reaction_u=gamma*(a-u+(u**2)*v)\n    reaction_v=gamma*(b-(u**2)*v)\n\n    f_u=f_u+reaction_u\n    f_v=f_v+reaction_v\n\n\n\n    f= np.concatenate((np.ravel(f_u),np.ravel(f_v))) \n    return f  \n\nsol=odeint(ShcnackPDErhs2d,u_0,t)\n#soln = solve_ivp(ShcnackPDErhs,(0, T), u_0, method='Radau')\n\n\nu_0=sol[0,0:N_x**2]\nv_0=sol[0,N_x**2:]\nu_0=np.reshape(u_0,(N_x,N_x))\nv_0=np.reshape(v_0,(N_x,N_x))\n\nu_m=sol[20,0:N_x**2]\nv_m=sol[20,N_x**2:]\nu_m=np.reshape(u_m,(N_x,N_x))\nv_m=np.reshape(v_m,(N_x,N_x))\n\nu=sol[-1,0:N_x**2]\nv=sol[-1,N_x**2:]\nu=np.reshape(u,(N_x,N_x))\nv=np.reshape(v,(N_x,N_x))\n\nfig, ax = plt.subplots(2,3)\nax[0,0].imshow(u_0)\nax[1,0].imshow(v_0)\nax[0,1].imshow(u_m)\nax[1,1].imshow(v_m)\nax[0,2].imshow(u)\nax[1,2].imshow(v)\n\n'''\nax[0].plot(x,u[0,:],'r')\nax[0].plot(x,u[16,:],'b')\nax[0].plot(x,u[32,:],'m')\nax[0].plot(x,u[48,:],'k')\nax[0].set_xlabel('$x$')\nax[0].set_ylabel('$u$')\n\nax[1].plot(x, v[0,:],'r--')\nax[1].plot(x, v[16,:],'b--')\nax[1].plot(x, v[32,:],'m--')\nax[1].plot(x, v[48,:],'k--')\nax[1].set_xlabel('$x$')\nax[1].set_ylabel('$v$')\n'''\n\nplt.xlabel('$x$')\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![DDI with Schnackenberg kinetics in 2D](DiffusionDrivenInstability_files/figure-html/fig-schnack_ddi_pde_2d-output-1.png){#fig-schnack_ddi_pde_2d width=566 height=416}\n:::\n:::\n\n\n## Linear Stability Analysis and Evolution of Spatial Pattern: General Conditions for Diffusion-driven Instability\n\nLet $\\Omega\\subset \\mathbb R^n$ be a domain with smooth (sufficiently regular) boundary  $\\partial \\Omega$, with outward unit normal ${\\mathbf{n}}$. Our general, non-dimensional reaction-diffusion system is then:\n\n$$\n\\begin{aligned}\n&\\frac{\\partial u}{\\partial  t} = \\gamma\\, f(u,v)  +  \\nabla^2 u, \\qquad x\\in \\Omega, \\quad t>0, \\\\\n&\\frac{\\partial v}{\\partial  t} = \\gamma\\, g(u,v)  + d \\nabla^2 v, \\qquad x\\in \\Omega, \\quad t>0, \\\\\n&\n\\end{aligned}\n$${#eq-pp}\ntogether with boundary and initial Conditions\n$$\n\\begin{aligned}\n\\nabla u \\cdot {\\mathbf{n} } = 0, \\qquad \\nabla v \\cdot {\\mathbf{n} } = 0, \\qquad x\\in \\partial \\Omega, \\quad t>0, \\\\\nu(x,0)  = u_0(x), \\qquad  v(x,0)  = v_0(x), \\qquad x\\in \\Omega\\; .\n\\end{aligned}\n$$ {#eq-pp_bc}\n\n\nA **spatially homogeneous steady-state** of @eq-pp  and @eq-pp_bc\nsatisfies \n$$\nf(u,v) = 0 , \\qquad g(u,v) =0\n$$\nand we denote it by $(u_0, v_0)$. \n\n\n### Stability of spatially homogeneous steady states to spatially homogeneous perturbations\n\nBefore we consider the effect of the spatial terms (i.e. diffusion) in @eq-pp  and @eq-pp_bc, we first of all explore the stability of the underlying spatially homogeneous steady state.\n\n\nConsider the following perturbations to the steady state $(u_0 , v_0)$:\n$$\nu(x,t) = u_0 + \\tilde u(t), \\quad  v(x,t) = v_0 + \\tilde v(t), \\qquad \\|\\tilde u(t) \\| \\ll 1, \\quad  \\|\\tilde v(t) \\| \\ll 1.\n$$ \n\nUpon substitution  into @eq-pp\n$$\n\\begin{aligned}\n\\frac{d\\tilde u}{d t} = \\gamma\\, f(u_0 + \\tilde u,v_0 + \\tilde v),  \\\\\n\\frac{d \\tilde v}{d  t} = \\gamma\\, g(u_0 + \\tilde u,v_0 + \\tilde v).\n\\end{aligned}\n$$ {#eq-pp_1}\n\n Using a Taylor expansion of $f$ and $g$ about $(u_0, v_0)$ we obtain the linearised system \n$$\n\\begin{pmatrix} \n\\tilde u_t \\\\\n\\tilde v_t\n\\end{pmatrix}  = \\gamma J  \\begin{pmatrix} \n\\tilde u \\\\\n\\tilde v\n\\end{pmatrix},\n$$ {#eq-linear_pp}\nwhere \n$$\nJ =J(u_0, v_0) =  \\begin{pmatrix} \nf_u & f_v  \\\\\ng_u & g_v \n\\end{pmatrix}_{(u_0 , v_0)} \\; .  \n$$\n\nThe general solution of @eq-linear_pp is  \n\n$$\n \\begin{pmatrix} \n\\tilde u(t) \\\\\n\\tilde v(t)\n\\end{pmatrix}   =  C_1 \\phi_1 e^{\\lambda_1 t} +  C_2 \\phi_2 e^{\\lambda_2 t}  , \n$$\nwhere $C_1$, $C_2$  are arbitrary constants, $\\lambda_1, \\lambda_2$ are the eigenvalues of $\\gamma J$, i.e. solutions of characteristic equation\n$$\n\\det (\\gamma J - \\lambda I) = 0,\n$$\nand $\\phi_1$, $\\phi_2$ are corresponding eigenvectors. It is easily seen that\n\n$$\n\\lambda_{1,2} = \\frac \\gamma 2 \\left( \\textrm{tr} (J) \\pm \\sqrt{ \\textrm{tr}(J)^2 - 4 \\det(J)} \\right),\n$$\n\nand thus a spatially homogeneous steady state $(u_0, v_0)$ is **stable** to spatially homogeneous perturbations if \n$$\n{\\mathrm Re}( \\lambda_{1,2}) <0,\n$$\n i.e. if \n\n$$\n\\begin{aligned}\n\\textrm{tr}(J) & = f_u + g_v < 0, \\\\\n\\det(J) & = f_u g_v - f_v g_u > 0. \n\\end{aligned}\n$${#eq-stable_hom}\n\n We shall be interested only in such parameter values for which conditions @eq-stable_hom are satisfied (i.e. the spatially homogeneous steady state is linearly stable in the absence of diffusion).\n\n### Stability of spatially homogeneous steady states to spatially heterogeneous: spatially dependent, perturbations\n\nWe now consider perturbations about the spatially homogeneous steady state that are spatially dependent i.e. \n$$\nu(x,t) = u_0 + \\tilde u(x,t), \\quad  v(x,t) = v_0 + \\tilde v(x,t), \\qquad \\|\\tilde u(x,t) \\| \\ll 1, \\quad  \\|\\tilde v(x,t) \\| \\ll 1 .\n$$ \n\nUpon substitution in @eq-pp and apply a Taylor expansion about $(u_0, v_0)$ to $f$ and $g$ to obtain the linearised problem \n\n$$\n\\begin{aligned}\n\\frac{\\partial \\tilde u(x,t)}{\\partial t} = \\gamma\\, \\left(f_u \\tilde u(x,t) + f_v \\tilde v(x,t)\\right) + \\nabla^2 \\tilde u(x,t)  , \\quad x\\in \\Omega, \\;  t >0, \\\\\n\\frac{\\partial \\tilde v(x,t)}{\\partial   t} = \\gamma\\,  \\left(g_u  \\tilde u(x,t) + g_v \\tilde v(x,t)\\right) +d \\nabla^2 \\tilde v(x,t)  ,  \\quad x\\in \\Omega, \\;  t >0,  \\\\\n\\end{aligned}\n$$ {#eq-pp_3}\nwith boundary conditions\n$$\n\\begin{aligned}\n{\\mathbf{n}} \\cdot \\nabla \\tilde u (x,t) = 0, \\qquad {\\mathbf{n}} \\cdot \\nabla \\tilde v (x,t)  = 0, \\qquad   x\\in   \\partial \\Omega, \\; t >0.\n\\end{aligned}\n$$ {#eq-pp_3bc}\n\nDefining \n$$\nV(x,t) = \\begin{pmatrix} \n\\tilde u(x,t) \\\\\n\\tilde v(x,t)\n\\end{pmatrix}\n$$ \nwe rewrite @eq-pp_3 as \n$$\n\\frac{\\partial}{\\partial t}  V(x,t) = \\gamma J  V(x,t) + D \\nabla^2   V(x,t), \n$$\n\nwhere\n\n\n$$\nD =  \\begin{pmatrix} \n1 & 0 \\\\\n0 & d \n\\end{pmatrix}\\;.\n$$\n\nWe shall consider a separation of variables approach, i.e.\n$$\nV(x,t) =\\begin{pmatrix}  \n \\bar u(t)  \\varphi_1(x)\n \\\\\n \\bar v(t)  \\varphi_2(x)\n \\end{pmatrix}\\;\n$$\nand obtain \n$$\n\\begin{aligned}\n\\frac{d \\bar u(t)}{d t}\\varphi_1(x) = \\gamma\\, \\left(f_u \\bar u(t) \\varphi_1(x) + f_v \\bar v(t) \\varphi_2(x)\\right) +\\bar u(t)  \\nabla^2 \\varphi_1(x)  , \\quad x\\in \\Omega, \\;  t >0, \\\\\n\\frac{d \\bar v(t)}{d t}\\varphi_2(x) = \\gamma\\,  \\left(g_u  \\bar u(t) \\varphi_1(x) + g_v \\bar v(t) \\varphi_2(x)\\right) +  d \\bar v(t) \\nabla^2  \\varphi_2(x)  ,  \\quad x\\in \\Omega, \\;  t >0,  \\\\\n\\end{aligned}\n$$ {#eq-pp_4}\n\nwith boundary conditions\n$$\n\\begin{aligned}\n{\\mathbf{n}} \\cdot \\nabla \\varphi_1(x) = 0, \\qquad {\\mathbf{n}} \\cdot \\nabla\\varphi_2 (x) = 0, \\qquad   x\\in   \\partial \\Omega, \\; t >0.\n\\end{aligned}\n$$ {#eq-pp_4bc}\n\nIt is assumed that \n$$\n\\bar u(t)\\, / \\hspace{-0.35 cm}\\equiv 0 \\quad \\textrm{and} \\quad  \\bar v(t)\\, / \\hspace{-0.35 cm}\\equiv 0\n$$ \nfor $t>0$. \n\n\n::: {#lem-laplacianeiegenvalues}\n\nConsider the spatial eigenvalue problem for the Laplacian $\\nabla^2$ with zero-Neumann boundary conditions i.e.\n\n$$\n\\begin{aligned}\n\\nabla^2 \\psi(x) = -k^2 \\psi(x) , \\qquad x \\in \\Omega ,  \\\\\n{\\mathbf{n}} \\cdot \\nabla \\psi(x) = 0 , \\qquad x\\in \\partial \\Omega \\; . \n\\end{aligned}\n$$ {#eq-ev}\n\nFor a bounded domain $\\Omega$ there exists a discrete set of eigenvalues \n$$\n0 \\leq k^2_1< k_2^2\\leq k_3^2\\leq \\ldots \\leq k_j^2\\leq \\ldots,\n$$\nwith \n$$\nj \\in \\mathbb N, \\quad  \\textrm{and} \\quad k_j^2 \\to \\infty \\quad \\textrm{as}  \\quad j \\to \\infty.\n$$\n\nMoreover, the eigenfunctions $\\{\\psi_k(x) \\}$\nform an **orthogonal set** of basis functions of the corresponding functional space (i.e. $L^2(\\Omega)$, $H^1(\\Omega)$).  \n\n:::\n\nThus we can look for the spatial component of the solution of @eq-pp_4 as follows:\n$$\n\\varphi(x) = \\begin{pmatrix}  \n\\varphi_1(x) \\\\\n\\varphi_2(x)\n \\end{pmatrix} = \\sum_k C_k \\psi_k(x), \\qquad C_k =  \\begin{pmatrix}  C_k^1 \\\\ C_k^2 \\end{pmatrix} \\in \\mathbb R^2 \\; \n$$\nand\n$$\n\\begin{aligned}\nV(x,t) =\\sum_k \\hat V_k(t) \\psi_k(x), \\qquad \\textrm{ where} \n\\quad \\hat V_k(t)=\n\\begin{pmatrix}  \nC_k^1 \\; \\bar u(t) \n \\\\\n C_k^2 \\; \\bar v(t) \n \\end{pmatrix}.\n\\end{aligned}\n$$ {#eq-vxt}\n\nSince $\\nabla^2 \\psi_k(x) = - k^2 \\psi_k(x)$ we obtain \n\n$$\nD \\nabla^2  V(x,t) = D \\nabla^2 \\left[ \\sum_k \\hat V_k(t) \\psi_k(x) \\right]   = \\sum_k D \\hat V_k(t) \\nabla^2 \\psi_k(x)= \n- \\sum_k k^2 D \\hat V_k(t)  \\psi_k(x).\n$$\n\n Hence \n\n$$\n\\sum_k \\frac{d}{d t}  \\hat V_k(t) \\psi_k(x)  =\n  \\sum_k \\gamma J \\hat V_k(t) \\psi_k(x) -  \\sum_k k^2  D \\hat V_k(t) \\psi_k(x). \n$$\n\nSince $\\{\\psi_k(x) \\}$ is a orthogonal basis we obtain that \n\n\n$$\n \\frac{d}{d t}  \\hat V_k(t) \\psi_k(x)  =\n   \\gamma J  \\hat V_k(t) \\psi_k(x) -  k^2  D \\hat V_k(t) \\psi_k(x), \n$$\nfor each $k$. Finally, since \n$$\n\\psi_k(x)\\;  /\\hspace{-0.35 cm }\\equiv 0\n$$ \nin $\\Omega$ this implies for each $k$ a system of ODEs:\n\n$$\n\\begin{aligned}\n \\frac{d}{d t}  \\hat V_k(t)   &=   \\left(\\gamma J  -  k^2  D\\right) \\hat V_k(t) &= \\tilde J\\hat V_k(t) ,\n\\end{aligned}\n$${#eq-stab_pp_ode}\n\nwhere $\\tilde J$ is a \"modified\" Jacobian:\n\n$$\n\\tilde{J} =  \\begin{pmatrix} \n\\gamma f_u - k^2 & \\gamma f_v \\\\\n\\gamma g_u & \\gamma g_v - d k^2\n\\end{pmatrix}\\;.\n$$\n\nNow solutions of @eq-stab_pp_ode are of the form \n$$\n\\hat V_k(t) = e^{\\lambda t} P_k\n$$\nwith $P_k \\in \\mathbb R^2$,  where, since $P_k\\neq  0$ (looking for nontrivial solutions), we find that $\\lambda$ are the eigenvalues of $\\tilde J$ , i.e. \n\nsolutions of the characteristic equation \n$$\n\\det(\\tilde J - \\lambda I) = \\det ( \\gamma J - k^2 D - \\lambda I) =0. \n$$ {#eq-charact_pp_1}\n\n\nEvaluating the above determinant, we arrive at the equation:\n$$\n\\lambda^2 + [ k^2 (1 + d) - \\gamma (f_u + g_v) ] \\lambda + h(k^2) = 0,\n$$ {#eq-spatial_eigenvalues}\nwhere \n$$\nh(k^2) = dk^4 - \\gamma (df_u + g_v) k^2 + \\gamma^2 | J | .\n$$ {#eq-hk2}\n\n::: {#fig-dispersion .cell execution_count=3}\n``` {.python .cell-code code-fold=\"true\"}\nimport numpy as np\nimport matplotlib.pyplot as plt\n\n# genera\nk_sq=np.linspace(0,25,100)\n\n\ngamma=10\nd_1=0.02\nd_2=3\nd_3=6\n\n\nf_u=0.2\ng_v=-0.5\nterm1=d*f_u+g_v\nJ=1.0 # positive determinant\n\n\n\ndef Computeh(k_sq,d):\n  h=d*k_sq**2-gamma*(term1)*k_sq+ gamma**2*J\n  return h\n\ndef SolveReLambda(k_sq,d):\n   # a lam^2 + b * lam +c\n    a=1\n    b= k_sq*(1+d)-gamma*(f_u+g_v)\n    c= Computeh(k_sq,d)\n    lambda_m= (-b-np.sqrt(b**2-4*a*c))/(2*a)\n    lambda_p= (-b+np.sqrt(b**2-4*a*c))//(2*a)\n    return lambda_m,lambda_p\n\ndef TestDDIconditions(d):\n\n    cond_1=f_u+g_v\n    cond_2 = J\n    cond_3 = d*f_u+g_v\n    cond_4 = (d*f_u+g_v)**2-4*d*J\n\n    cond_true=np.zeros((4,1),dtype=bool)\n    cond_true[0]=(cond_1<0) \n    cond_true[1]= (cond_2>0) \n    cond_true[2]= (cond_3>0)\n    cond_true[3]=(cond_4<0)\n\n\n    return cond_true\n\nh_1=Computeh(k_sq,d_1)\nh_2=Computeh(k_sq,d_2)\nh_3=Computeh(k_sq,d_3)\n\nl_1_m, l_1_p = SolveReLambda(k_sq,d_1)\nl_2_m, l_2_p = SolveReLambda(k_sq,d_2)\nl_3_m, l_3_p = SolveReLambda(k_sq,d_3)\n\nconditions_satisfied1=TestDDIconditions(d_1)\nconditions_satisfied2=TestDDIconditions(d_2)\nconditions_satisfied3=TestDDIconditions(d_3)\n\nprint(conditions_satisfied1,conditions_satisfied2,conditions_satisfied3)\n\nfig, ax=plt.subplots()\nax.plot(k_sq,h_1,'r',k_sq,h_2,'k',k_sq,h_3,'m')\nplt.grid()\nax.set_xlabel('$k^2$')\nax.set_ylabel('$h$')\nax.legend(['d='+str(d_1),'d='+str(d_2),'d='+str(d_3)])\nplt.show()\n\nfig, ax=plt.subplots()\nax.plot(k_sq,np.real(l_1_m),'r',k_sq,np.real(l_2_m),'k',k_sq,np.real(l_3_m),'m')\nax.plot(k_sq,np.real(l_1_p),'r--',k_sq,np.real(l_2_p),'k--',k_sq,np.real(l_3_p),'m--')\n\nplt.grid()\nax.set_xlabel('$k^2$')\nax.set_ylabel('$\\Re{\\lambda}$')\nax.set_ylim([-20,5])\n\nax.legend(['d='+str(d_1),'d='+str(d_2),'d='+str(d_3)])\nplt.show()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[[ True]\n [ True]\n [False]\n [False]] [[ True]\n [ True]\n [ True]\n [ True]] [[ True]\n [ True]\n [ True]\n [ True]]\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![A plot of $h(k^2)$ against k^2.](DiffusionDrivenInstability_files/figure-html/fig-dispersion-output-2.png){#fig-dispersion-1 width=613 height=431}\n:::\n\n::: {.cell-output .cell-output-display}\n![](DiffusionDrivenInstability_files/figure-html/fig-dispersion-output-3.png){#fig-dispersion-2 width=596 height=436}\n:::\n:::\n\n\n**NOTE**: From @eq-charact_pp_1, @eq-spatial_eigenvalues we can recover the characteristic equation for the spatially homogeneous perturbation when $k=0$, i.e. \n$$\n\\tilde J \\Big|_{k=0} = ( \\gamma J - k^2 D )\\Big|_{k=0} = \\gamma J.\n$$ \n\nThus the steady state $(u_0, v_0)$ is **unstable** to spatially heterogeneous perturbations iff\n$$\n{\\mathrm Re}(\\lambda_1) > 0 \\quad \\textrm{and/or} \\quad {\\mathrm Re}(\\lambda_2) >0,\n$$\nwhere $\\lambda_{1,2}$ are solutions of @eq-charact_pp_1, @eq-spatial_eigenvalues.\n\n\nNow for \n$$\n{\\mathrm Re}(\\lambda_1) > 0 \\quad \\textrm{and/or } \\quad {\\mathrm Re}(\\lambda_2) >0\n$$\nto be satisfied we require\n$$\n\\textrm{tr}(\\tilde J) > 0 \\quad \\textrm{ or } \\quad \\det(\\tilde J) <0.\n$$\n\nConsider first ${\\mathrm tr} (\\tilde{J})$. We have\n$$\n\\textrm{tr}(\\tilde J) = \\gamma ( f_u+ g_v) - k^2(1+d) < 0, \\hspace{4 cm}  \n$$\nsince $\\gamma > 0$ and \n$$ \nf_u+ g_v < 0\n$$ \nby the stability condition for the spatially homogeneous perturbation @eq-stable_hom.\n\nThus instability to the spatially heterogeneous perturbation *can only occur* if \n$$\n\\det(\\tilde J) < 0\n$$ \nand so we require:\n$$\n\\det(\\tilde J) = h(k^2) = dk^4  - \\gamma ( d\\,  f_u + g_v) k^2 + \\gamma^2 \\det(J) < 0. \n$$\nFrom the spatially homogeneous stability conditions @eq-stable_hom we have $\\det(J) >0$. Thus $h(k^2)<0$ is possible only if \n$$\nd f_u + g_v >0.\n$$ {#eq-stabil_cond_nes}\n\nHowever, once again, due to @eq-stable_hom, we have $f_u+ g_v <0$, and so we can conclude that $d\\neq 1$ and $f_u$ and $g_v$ must have *opposite signs*. \n\nCondition @eq-stabil_cond_nes is *necessary but not sufficient* to ensure $h(k^2) <0$. In order to guarantee that $h(k^2) < 0$, the minimum value $h_{min}$ must be negative. Differentiating @eq-hk2 w.r.t. $k^2$, we find that:\n\n$$\nk^2_{m} = \\gamma \\frac{d f_u + g_v}{2d} \\;\\; \\Rightarrow \\;\\; h_{{\\mathrm min}} = \\gamma^2 \\left[ | J | - \\frac{(df_u + g_v)^2}{4d} \\right].\n$$ {#eq-hmin}\n\nThus the condition that $h(k^2) < 0$ for some $k^2$ is:\n\n$$\n\\frac{(df_u + g_v)^2}{4d} > |J|.\n$$\n\nThe transition from stability to instability i.e. **bifurcation**, occurs when $h_{{\\mathrm min}} = 0$. From @eq-hmin, this means at bifurcation we have \n$$\n|J| = \\frac{(df_u + g_v)^2}{4d}.\n$$ {#eq-bif}\n\nFor a fixed set of kinetics parameters, this means that we have a  **critical diffusion coefficient** $d_c \\;(>1)$, which, after re-arranging @eq-bif, is the appropriate root of \n\n$$\nq(d_c) = d^2_c f_u^2 + 2( 2 f_v g_u - f_u g_v) d_c + g_v^2 =0.\n$$ {#eq-dcrit}\n\n\n\nFinally, we note that using @eq-hmin, @eq-bif, the **critical wave number** can be written: \n$$\nk_c^2 =\\gamma  \\frac{( d_c f_u + g_v)} { 2 d_c} = \\gamma \\left[ \\frac {|J|}{d_c} \\right]^{1/2} = \\gamma \\left[ \\frac{f_u g_v - f_v g_u}{d_c} \\right]^{1/2}. \n$$ {#eq-kcrit}\n\n@fig-dispersion (a) shows a schematic diagram of the (quadratic) function $h(k^2)$ for three different values of the diffusion coefficient $d$: \n\n* $d < d_c, \\; h(k^2) > 0$, and there is no pattern; \n* $d = d_c, \\; h_{min} = 0$, critical case; \n* $d > d_c, \\; h(k^2) < 0$, and there is pattern. \n\nHence we can see from @eq-spatial_eigenvalues that whenever $h(k^2) < 0$ the curve $\\lambda(k^2)$ is positive for the same range of wavenumbers that make $h(k^2)$ negative. The range of unstable wavenumbers \n$$\nk^2_1 < k^2 < k^2_2\n$$ \ncan be found from the roots of @eq-hk2, $h(k^2) = 0$:\n\n$$\n\\begin{aligned}\nk^2_1 &= \\gamma \\frac{(df_u + g_v) - \\left\\{ (df_u + g_v)^2 -4d |J| \\right\\}^{1/2} }{2d} < k^2  \\\\\n&< \\gamma \\frac{(df_u + g_v) +  \\left\\{ (df_u + g_v)^2 -4d |J| \\right\\}^{1/2}}{2d} = k^2_2 \n\\end{aligned}\n$$ {#eq-k2range}\n\n@fig-dispersion (b) shows a schematic diagram of ${\\mathrm Re}\\lambda (k^2)$ for three different values of the diffusion coefficient $d$:\n*  $d < d_c, \\; ${\\mathrm Re}\\lambda (k^2)$ < 0, \\forall k^2 $, and there is no pattern; \n*  $d = d_c, \\; k^2_c = 0$, critical case; \n\nThe expression $\\lambda = \\lambda (k^2)$ is known as the *dispersion relation* and the plot of ${\\mathrm Re} \\lambda$ against $k^2$ is known as the *dispersion curve*. \n\nFrom the previous analysis, within the unstable range of wavenumbers $(k^2_1 , k^2_2)$, ${\\mathrm Re}\\lambda (k^2) > 0$ has a *maximum value* at wavenumber $k^2_m$ given by @eq-hmin when $d > d_c$. This implies that there is a *fastest growing mode* in the solution @eq-vxt of our linearised system @eq-pp_4.  \n\n  \n\nRecalling @eq-vxt,   \n$$\nV(x,t) = \\sum_k C_k e^{\\lambda(k^2) t} \\, \\psi_k(x),\n$$\nand noting the above analysis, this implies that as $t\\to \\infty$ the dominant contributions in the above sum are those for which ${\\mathrm Re} \\lambda(k^2) > 0$, since all other modes will tend to zero exponentially fast as $t\\to \\infty$. Thus, for large $t$, the solution is effectively given by:\n$$\nV(x,t) \\approx \\sum_{k_{1}}^{k_2} C_k e^{\\lambda(k^2) t} \\, \\psi_k(x) \\; .\n$$\n\n\n%The critical value of $d=d_c$ at which the  bifurcation to instability occurs is defined by  $h_{\\textrm{min}} =0$, i.e. such value of $d$ at which $h(k^2)=0$ has a double root. \n\n\n** include figure dispersion **\n\n\n\n\n**NOTE** \n\nAll the previous calculations concern a **linear stability analysis** carried out about a spatially homogeneous steady state of the system @eq-pp. This linear theory indicates that for $d > d_c$ there exists a finite number of **linearly unstable** spatial eigenfunctions which grow exponentially as $t \\to \\infty$. However, this linear theory holds only when we are close to the steady state i.e. it only holds for small perturbations. In the full **nonlinear system** the exponentially growing (unbounded) modes will eventually be bounded by the nonlinear terms and so bounded, stable spatial patterns characterised by the corresponding wavenumbers will be formed. \n\n**Summary**\n\nWe have obtained conditions for the generation of spatial patterns via systems of reaction-diffusion equations of the general form @eq-pp. Such systems involve **two chemicals or morphogens** reacting and diffusing together to generate a chemical pre-pattern that underlies a subsequent cellular pattern. The four conditions are as follows:\n\n$$\n\\begin{aligned}\nf_u + g_v &< 0, \\\\\nf_u g_v - f_v g_u &> 0, \\\\\nd f_u + g_v &> 0, \\\\\n(d f_u + g_v)^2 - 4d (f_u g_v - f_v g_u)^2 &< 0 , \\nonumber \n\\end{aligned}\n$$ {#eq-pattern_conditions}\nwith all partial derivatives being evaluated at the spatially homogeneous steady state $(u_0 , v_0)$. \n\nFrom the first and third conditions, $d \\neq 1$ and $f_u$ and $g_v$ must be of different signs. For each of the reaction kinetics mentioned here (Schnakenberg, Gierer-Meinhardt, Thomas), we have that $f_u > 0, g_v < 0$ and so this implies that $d > 1$. \n\nIf the conditions @eq-pattern_conditions are satisfied, then there is a range of unstable wavenumbers given by @eq-k2range which give rise to a spatial pattern. The spatial patterns which initially grow are those spatial eigenfunctions $\\psi_k(x)$ whose wavenumbers $k$ are such that $k_1 < k < k_2$. \n\nIn most biological systems, the kinetic parameters and diffusion coefficients are fixed. This means that the only variable parameter in the system is $\\gamma$ which as we have seen is related to the size of the domain under consideration. This has implications when considering patterns on finite domains, as will be seen in the next section. \n\n## Exercises\nDemonstrate that the derived results are consistent with  numerical solutions. Some predictions to test:\n\n* No patterning when diffusion coefficients are equal\n* How does spatial pattern formation change as you try  values of parameters $a$ and $b$?\n* Can you correlate the observation of pattern to the conditions for DDI being satisfied?\n* what about different kinetics (e.g. Gierer-Meinhardt, Thomas models)?\n\n## References\n\n",
    "supporting": [
      "DiffusionDrivenInstability_files"
    ],
    "filters": [],
    "includes": {}
  }
}